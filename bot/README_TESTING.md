# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Webhook Endpoints

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
```bash
cd bot
python main.py
```

### 2. –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã
```bash
cd bot
python test_webhook.py
```

## üîç –î–æ—Å—Ç—É–ø–Ω—ã–µ Endpoints

### ‚úÖ –ö–æ—Ä–Ω–µ–≤–æ–π endpoint
- **–ü—É—Ç—å:** `/`
- **–ú–µ—Ç–æ–¥:** GET
- **–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:** `200 OK` —Å —Ç–µ–∫—Å—Ç–æ–º "Telegram Bot Webhook Server is running!"

### ‚úÖ Health endpoint
- **–ü—É—Ç—å:** `/health`
- **–ú–µ—Ç–æ–¥:** GET
- **–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:** `200 OK` —Å JSON –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ webhook

### ‚úÖ Webhook endpoint
- **–ü—É—Ç—å:** `/webhook`
- **–ú–µ—Ç–æ–¥:** POST (—Ç–æ–ª—å–∫–æ –æ—Ç Telegram)
- **–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:** `200 OK` –¥–ª—è –≤–∞–ª–∏–¥–Ω—ã—Ö webhook –∑–∞–ø—Ä–æ—Å–æ–≤

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä—É—á–Ω—É—é

### –° –ø–æ–º–æ—â—å—é curl

```bash
# –¢–µ—Å—Ç –∫–æ—Ä–Ω–µ–≤–æ–≥–æ endpoint
curl http://localhost:8000/

# –¢–µ—Å—Ç health endpoint
curl http://localhost:8000/health

# –¢–µ—Å—Ç webhook endpoint (GET - –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 405)
curl http://localhost:8000/webhook

# –¢–µ—Å—Ç webhook endpoint (POST)
curl -X POST http://localhost:8000/webhook \
  -H "Content-Type: application/json" \
  -d '{"test": "data"}'
```

### –° –ø–æ–º–æ—â—å—é –±—Ä–∞—É–∑–µ—Ä–∞

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
- `http://localhost:8000/` - –∫–æ—Ä–Ω–µ–≤–æ–π endpoint
- `http://localhost:8000/health` - health endpoint

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤

| Endpoint | –ú–µ—Ç–æ–¥ | –û–∂–∏–¥–∞–µ–º—ã–π —Å—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|------------------|----------|
| `/` | GET | 200 OK | –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç |
| `/health` | GET | 200 OK | JSON —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ |
| `/webhook` | GET | 405 Method Not Allowed | GET –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è |
| `/webhook` | POST | 200 OK | Webhook –æ—Ç Telegram |
| `/webhook` | PUT | 405 Method Not Allowed | PUT –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è |

## üîß –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ `/webhook` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

```bash
# –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f logs/bot.log

# –§–∏–ª—å—Ç—Ä—É–π—Ç–µ –ª–æ–≥–∏ webhook
grep "webhook" logs/bot.log
grep "üì® –ü–æ–ª—É—á–µ–Ω" logs/bot.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ webhook

–í –ª–æ–≥–∞—Ö –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
INFO - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º webhook –Ω–∞ URL: https://yourdomain.com/webhook
INFO - Webhook —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: https://yourdomain.com/webhook
INFO - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ webhook: {...}
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞ "Port already in use"

```bash
# –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –ø–æ—Ä—Ç 8000
netstat -tlnp | grep :8000

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å
kill -9 <PID>
```

### –û—à–∏–±–∫–∞ "Method Not Allowed"

–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è GET/PUT –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ `/webhook`. Telegram –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ POST.

### Endpoint –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 8000 –¥–æ—Å—Ç—É–ø–µ–Ω

## üìù –ü—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤

### Health endpoint
```json
{
  "status": "ok",
  "webhook_url": "https://yourdomain.com/webhook",
  "host": "127.0.0.1",
  "port": 8000
}
```

### Webhook endpoint (POST)
```json
{
  "status": "received",
  "data": {
    "test": "data",
    "message": "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π webhook –∑–∞–ø—Ä–æ—Å"
  }
}
```

## üéØ –¶–µ–ª—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç:

1. **–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω** - endpoint `/` –æ—Ç–≤–µ—á–∞–µ—Ç
2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã** - endpoint `/health` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
3. **Webhook —Ä–∞–±–æ—Ç–∞–µ—Ç** - endpoint `/webhook` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç POST –∑–∞–ø—Ä–æ—Å—ã
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç–æ–¥—ã –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è CI/CD –¥–æ–±–∞–≤—å—Ç–µ –≤ –≤–∞—à pipeline:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install aiohttp

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã
python test_webhook.py

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ exit code
echo $?
```
